{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Yanni\\\\OneDrive\\\\Desktop\\\\alt\\\\Task4Pi\\\\src\\\\Shop\\\\index.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport axios from 'axios';\nimport ProductCard from './components/ProductCard';\nimport SignIn from './components/SignIn';\nimport Header from './components/Header';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n;\n\n// Make TS accept the existence of our window.__ENV object - defined in index.html:\n\nconst _window = window;\nconst backendURL = _window.__ENV && _window.__ENV.backendURL;\nconst axiosClient = axios.create({\n  baseURL: `${backendURL}`,\n  timeout: 20000,\n  withCredentials: true\n});\nconst config = {\n  headers: {\n    'Content-Type': 'application/json',\n    'Access-Control-Allow-Origin': '*'\n  }\n};\nexport default function Shop() {\n  _s();\n  const [user, setUser] = useState(null);\n  const [showModal, setShowModal] = useState(false);\n  const signIn = async () => {\n    const scopes = ['username', 'payments'];\n    const authResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);\n    signInUser(authResult);\n    setUser(authResult.user);\n  };\n  const signOut = () => {\n    setUser(null);\n    signOutUser();\n  };\n  const signInUser = authResult => {\n    axiosClient.post('/user/signin', {\n      authResult\n    });\n    return setShowModal(false);\n  };\n  const signOutUser = () => {\n    return axiosClient.get('/user/signout');\n  };\n  const onModalClose = () => {\n    setShowModal(false);\n  };\n  const orderProduct = async (memo, amount, paymentMetadata) => {\n    if (user === null) {\n      return setShowModal(true);\n    }\n    const paymentData = {\n      amount,\n      memo,\n      metadata: paymentMetadata\n    };\n    const callbacks = {\n      onReadyForServerApproval,\n      onReadyForServerCompletion,\n      onCancel,\n      onError\n    };\n    const payment = await window.Pi.createPayment(paymentData, callbacks);\n    console.log(payment);\n  };\n  const onIncompletePaymentFound = payment => {\n    console.log(\"onIncompletePaymentFound\", payment);\n    return axiosClient.post('/payments/incomplete', {\n      payment\n    });\n  };\n  const onReadyForServerApproval = paymentId => {\n    console.log(\"onReadyForServerApproval\", paymentId);\n    axiosClient.post('/payments/approve', {\n      paymentId\n    }, config);\n  };\n  const onReadyForServerCompletion = (paymentId, txid) => {\n    console.log(\"onReadyForServerCompletion\", paymentId, txid);\n    axiosClient.post('/payments/complete', {\n      paymentId,\n      txid\n    }, config);\n  };\n  const onCancel = paymentId => {\n    console.log(\"onCancel\", paymentId);\n    return axiosClient.post('/payments/cancelled_payment', {\n      paymentId\n    });\n  };\n  const onError = (error, payment) => {\n    console.log(\"onError\", error);\n    if (payment) {\n      console.log(payment);\n      // handle the error accordingly\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      user: user,\n      onSignIn: signIn,\n      onSignOut: signOut\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProductCard, {\n      name: \"Apple Pie\",\n      description: \"You know what this is. Pie. Apples. Apple pie.\",\n      price: 3,\n      pictureURL: \"https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Apple_pie.jpg/1280px-Apple_pie.jpg\",\n      pictureCaption: \"Picture by Dan Parsons - https://www.flickr.com/photos/dan90266/42759561/, CC BY-SA 2.0, https://commons.wikimedia.org/w/index.php?curid=323125\",\n      onClickBuy: () => orderProduct(\"Order Apple Pie\", 3, {\n        productId: 'apple_pie_1'\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProductCard, {\n      name: \"Lemon Meringue Pie\",\n      description: \"Non-contractual picture. We might have used oranges because we had no lemons. Order at your own risk.\",\n      price: 5,\n      pictureURL: \"https://live.staticflickr.com/1156/5134246283_f2686ff8a8_b.jpg\",\n      pictureCaption: \"Picture by Sistak - https://www.flickr.com/photos/94801434@N00/5134246283, CC BY-SA 2.0\",\n      onClickBuy: () => orderProduct(\"Order Lemon Meringue Pie\", 5, {\n        productId: 'lemon_pie_1'\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }, this), showModal && /*#__PURE__*/_jsxDEV(SignIn, {\n      onSignIn: signIn,\n      onModalClose: onModalClose\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 22\n    }, this)]\n  }, void 0, true);\n}\n_s(Shop, \"7F3ln6W08puJMs22ml1OmKJPERk=\");\n_c = Shop;\nvar _c;\n$RefreshReg$(_c, \"Shop\");","map":{"version":3,"names":["React","useState","axios","ProductCard","SignIn","Header","jsxDEV","_jsxDEV","Fragment","_Fragment","_window","window","backendURL","__ENV","axiosClient","create","baseURL","timeout","withCredentials","config","headers","Shop","_s","user","setUser","showModal","setShowModal","signIn","scopes","authResult","Pi","authenticate","onIncompletePaymentFound","signInUser","signOut","signOutUser","post","get","onModalClose","orderProduct","memo","amount","paymentMetadata","paymentData","metadata","callbacks","onReadyForServerApproval","onReadyForServerCompletion","onCancel","onError","payment","createPayment","console","log","paymentId","txid","error","children","onSignIn","onSignOut","fileName","_jsxFileName","lineNumber","columnNumber","name","description","price","pictureURL","pictureCaption","onClickBuy","productId","_c","$RefreshReg$"],"sources":["C:/Users/Yanni/OneDrive/Desktop/alt/Task4Pi/src/Shop/index.tsx"],"sourcesContent":["import React, {useState} from 'react';\r\nimport axios from 'axios';\r\nimport ProductCard from './components/ProductCard';\r\nimport SignIn from './components/SignIn';\r\nimport Header from './components/Header';\r\n\r\ntype MyPaymentMetadata = {};\r\n\r\ntype AuthResult = {\r\n  accessToken: string,\r\n  user: {\r\n    uid: string,\r\n    username: string\r\n  }\r\n};\r\n\r\nexport type User = AuthResult['user'];\r\n\r\ninterface PaymentDTO {\r\n  amount: number,\r\n  user_uid: string,\r\n  created_at: string,\r\n  identifier: string,\r\n  metadata: Object,\r\n  memo: string,\r\n  status: {\r\n    developer_approved: boolean,\r\n    transaction_verified: boolean,\r\n    developer_completed: boolean,\r\n    cancelled: boolean,\r\n    user_cancelled: boolean,\r\n  },\r\n  to_address: string,\r\n  transaction: null | {\r\n    txid: string,\r\n    verified: boolean,\r\n    _link: string,\r\n  },\r\n};\r\n\r\n// Make TS accept the existence of our window.__ENV object - defined in index.html:\r\ninterface WindowWithEnv extends Window {\r\n  __ENV?: {\r\n    backendURL: string, // REACT_APP_BACKEND_URL environment variable\r\n    sandbox: \"true\" | \"false\", // REACT_APP_SANDBOX_SDK environment variable - string, not boolean!\r\n  }\r\n}\r\n\r\nconst _window: WindowWithEnv = window;\r\nconst backendURL = _window.__ENV && _window.__ENV.backendURL;\r\n\r\nconst axiosClient = axios.create({ baseURL: `${backendURL}`, timeout: 20000, withCredentials: true});\r\nconst config = {headers: {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'}};\r\n\r\n\r\nexport default function Shop() {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [showModal, setShowModal] = useState<boolean>(false);\r\n\r\n  const signIn = async () => {\r\n    const scopes = ['username', 'payments'];\r\n    const authResult: AuthResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);\r\n    signInUser(authResult);\r\n    setUser(authResult.user);\r\n  }\r\n\r\n  const signOut = () => {\r\n    setUser(null);\r\n    signOutUser();\r\n  }\r\n\r\n  const signInUser = (authResult: AuthResult) => {\r\n    axiosClient.post('/user/signin', {authResult});\r\n    return setShowModal(false);\r\n  }\r\n\r\n  const signOutUser = () => {\r\n    return axiosClient.get('/user/signout');\r\n  }\r\n\r\n  const onModalClose = () => {\r\n    setShowModal(false);\r\n  }\r\n\r\n  const orderProduct = async (memo: string, amount: number, paymentMetadata: MyPaymentMetadata) => {\r\n    if(user === null) {\r\n      return setShowModal(true);\r\n    }\r\n    const paymentData = { amount, memo, metadata: paymentMetadata };\r\n    const callbacks = {\r\n      onReadyForServerApproval,\r\n      onReadyForServerCompletion,\r\n      onCancel,\r\n      onError\r\n    };\r\n    const payment = await window.Pi.createPayment(paymentData, callbacks);\r\n    console.log(payment);\r\n  }\r\n\r\n  const onIncompletePaymentFound = (payment: PaymentDTO) => {\r\n    console.log(\"onIncompletePaymentFound\", payment);\r\n    return axiosClient.post('/payments/incomplete', {payment});\r\n  }\r\n\r\n  const onReadyForServerApproval = (paymentId: string) => {\r\n    console.log(\"onReadyForServerApproval\", paymentId);\r\n    axiosClient.post('/payments/approve', {paymentId}, config);\r\n  }\r\n\r\n  const onReadyForServerCompletion = (paymentId: string, txid: string) => {\r\n    console.log(\"onReadyForServerCompletion\", paymentId, txid);\r\n    axiosClient.post('/payments/complete', {paymentId, txid}, config);\r\n  }\r\n\r\n  const onCancel = (paymentId: string) => {\r\n    console.log(\"onCancel\", paymentId);\r\n    return axiosClient.post('/payments/cancelled_payment', {paymentId});\r\n  }\r\n\r\n  const onError = (error: Error, payment?: PaymentDTO) => {\r\n    console.log(\"onError\", error);\r\n    if (payment) {\r\n      console.log(payment);\r\n      // handle the error accordingly\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Header user={user} onSignIn={signIn} onSignOut={signOut}/>\r\n\r\n      <ProductCard\r\n        name=\"Apple Pie\"\r\n        description=\"You know what this is. Pie. Apples. Apple pie.\"\r\n        price={3}\r\n        pictureURL=\"https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Apple_pie.jpg/1280px-Apple_pie.jpg\"\r\n        pictureCaption=\"Picture by Dan Parsons - https://www.flickr.com/photos/dan90266/42759561/, CC BY-SA 2.0, https://commons.wikimedia.org/w/index.php?curid=323125\"\r\n        onClickBuy={() => orderProduct(\"Order Apple Pie\", 3, { productId: 'apple_pie_1' })}\r\n      />\r\n      <ProductCard\r\n        name=\"Lemon Meringue Pie\"\r\n        description=\"Non-contractual picture. We might have used oranges because we had no lemons. Order at your own risk.\"\r\n        price={5}\r\n        pictureURL=\"https://live.staticflickr.com/1156/5134246283_f2686ff8a8_b.jpg\"\r\n        pictureCaption=\"Picture by Sistak - https://www.flickr.com/photos/94801434@N00/5134246283, CC BY-SA 2.0\"\r\n        onClickBuy={() => orderProduct(\"Order Lemon Meringue Pie\", 5, { productId: 'lemon_pie_1' })}\r\n      />\r\n\r\n      { showModal && <SignIn onSignIn={signIn} onModalClose={onModalClose} /> }\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}